name: 安卓自动签到

# 触发条件：定时触发和手动触发
on:
  schedule:
    # 定时在北京时间6点执行（UTC时间是22点，因为UTC+8=北京时间）
    - cron: '0 22 * * *'
  workflow_dispatch:  # 允许手动触发

jobs:
  checkin:
    runs-on: ubuntu-latest
    steps:
      - name: 签到操作
        run: |
          import requests
          import os
          
          url = "https://api.planet.shenxu.net.cn/planet/api/client/punch/dates"
          headers = {
            "sign": "58527e8627e57e37ffe5b17d9a60c12c",
            "user-agent": "Mozilla/5.0 (Linux; Android 14; M2102K1C Build/UKQ1.240624.001; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/138.0.7204.168 Mobile Safari/537.36 uni-app Html5Plus/1.0 (Immersed/39.142857)",
            "Content-Type": "application/x-www-form-urlencoded",
            "Host": "api.planet.shenxu.net.cn",
            "Connection": "Keep-Alive",
            "Accept-Encoding": "gzip"
          }
          
          # 从环境变量获取session3rd（实际值来自GitHub Secrets的AZID）
          session3rd = os.getenv('AZID')
          if not session3rd:
              raise ValueError("AZID环境变量未设置，请检查GitHub Secrets配置")
              
          data = f"scene=0&version=1.1.11&session3rd={session3rd}"
          
          try:
              res = requests.post(url, headers=headers, data=data)
              print(f"签到响应: {res.text}")
              res.raise_for_status()  # 如果响应状态码不是200，抛出异常
              print("签到成功")
          except Exception as e:
              print(f"签到失败: {str(e)}")
              raise  # 抛出异常，让Action显示失败状态
        shell: python
        env:
          AZID: ${{ secrets.AZID }}  # 从GitHub Secrets获取AZID并设置为环境变量
